{% extends "layout.html" %}
{% block body %}
  <form class="register-container" id="app" method="post" action="/register">
    <div class="register-element">
      <input class="register-element-input" name="email" v-model.trim="email" maxlength="40"
             placeholder="输入邮箱">@yiduyongche.com
    </div>
    <div class="register-element">
      <input class="register-element-input" name="password" v-model="password" maxlength="16" placeholder="输入密码，8-16位">
    </div>
    <div class="register-element">
      <input class="register-element-input" name="code" v-model="code" maxlength="6" placeholder="输入6位验证码">
      <button class="register-element-code" type="button" @click="obtainCodeClick">获取验证码</button>
    </div>
    <button class="register-element-input" type="button" @click="registerClick" >注册</button>

    <div v-bind:class="[success ? 'message-success':'message-failure']">[[message]]</div>
  </form>
  <script>
    new Vue({
      el: '#app',
      delimiters: ['[[', ']]'],
      data: {
        email: 'huyuguo',
        password: '12345678',
        code: '123456',
        message: '',
        success: true
      },
      methods: {
        registerClick: function () {
          if (this.checkRegister()) {
            document.forms[0].submit()
          }
        },
        checkRegister: function () {
          if (this.email.length === 0) {
            this.message = '请输入正确的邮箱!'
            this.success = false
            return false
          }
          if (this.password.length < 8 || this.password.length > 16) {
            this.message = '请输入8-16位的密码！'
            this.success = false
            return false
          }
          if (this.code.length != 6) {
            this.message = '请输入6位验证码'
            this.success = false
            return false
          }
          return true
        },
        obtainCodeClick: function () {
          if (this.email.length === 0) {
            this.message = '请输入正确的邮箱!'
            this.success = false
            return false
          }

          axios.get('/obtain_code', {
            params: {
              email: this.email
            }
          }).then(res => {
            if (res.data.status == 0) {
              this.message = res.data.msg
              this.success = true
            } else {
              this.message = res.data.msg
              this.success = false
            }
          }).catch(error => {
            console.log(error)
          })
        }
      }
    })
  </script>
{% endblock %}

